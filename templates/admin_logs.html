<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - ëŒ€í™” ë¡œê·¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background: radial-gradient(circle at center, #808080 0%, #707070 20%, #606060 40%, #505050 60%, #404040 80%, #303030 100%);
            min-height: 100vh;
        }
        .header {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #808080;
        }
        .header h1 {
            margin: 0;
            color: #333;
        }
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }
        .btn-primary {
            background: radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-blocked {
            background: radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-feedback {
            background: radial-gradient(circle at center, #28a745 0%, #218838 40%, #1e7e34 70%, #155724 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        
        .btn-feedback.dislike {
            background: radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%);
        }
        
        .btn-secondary {
            background: radial-gradient(circle at center, #6c757d 0%, #5a6268 40%, #495057 70%, #343a40 100%);
            color: white;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            text-align: center;
            border: 1px solid #808080;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        .controls {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #808080;
        }
        .feedback-section {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            padding: 20px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            margin-bottom: 20px;
            border: 1px solid #808080;
        }
        .log-item {
            background: radial-gradient(circle at center, #e0e0e0 0%, #d0d0d0 20%, #c0c0c0 40%, #b0b0b0 60%, #a0a0a0 80%, #909090 100%);
            margin-bottom: 15px;
            border-radius: 0px;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.9),
                inset 0 -1px 0 rgba(0,0,0,0.2);
            overflow: hidden;
            border: 1px solid #808080;
        }
        .log-header {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
        }
        .log-time {
            color: #666;
            font-size: 14px;
        }
        .log-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-fallback {
            background: #f8d7da;
            color: #721c24;
        }
        .log-content {
            padding: 20px;
        }
        .log-question {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-radius: 0px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        .log-answer {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            border-radius: 0px;
            white-space: pre-wrap;
            line-height: 1.5;
            border: 1px solid #dee2e6;
        }
        .feedback-item {
            background: radial-gradient(circle at center, #f8f9fa 0%, #e9ecef 20%, #dee2e6 40%, #ced4da 60%, #adb5bd 80%, #6c757d 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 0px;
            border: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .feedback-content {
            flex: 1;
        }
        .feedback-type {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .feedback-like {
            background: #d4edda;
            color: #155724;
        }
        .feedback-dislike {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            text-align: center;
            color: #666;
            padding: 40px;
        }
        .no-logs {
            text-align: center;
            color: #666;
            padding: 40px;
            font-size: 18px;
        }
        .auto-refresh {
            margin-left: 10px;
            font-size: 12px;
            color: #666;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .btn-warning {
            background: radial-gradient(circle at center, #ffc107 0%, #e0a800 40%, #d39e00 70%, #b08800 100%);
            color: #212529;
            box-shadow: 
                0 3px 6px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.6),
                inset 0 -1px 0 rgba(0,0,0,0.3);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š ê´€ë¦¬ì - ëŒ€í™” ë¡œê·¸</h1>
        <div class="header-buttons">
            <a href="/" class="btn btn-primary">ğŸ¤– ì±—ë´‡</a>
            <button class="btn btn-primary" onclick="refreshData()">ìƒˆë¡œê³ ì¹¨</button>
            <a href="/admin/logout" class="btn btn-secondary">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
    
    <div class="stats" id="stats">
        <div class="loading">í†µê³„ ë¡œë”© ì¤‘...</div>
    </div>
    
    <div class="controls">
        <div style="margin-bottom: 15px;">
            <strong>íƒ­ ì„ íƒ:</strong>
            <button class="btn btn-primary" onclick="showTab('chat')" id="tab-chat">ğŸ’¬ ëŒ€í™” ë¡œê·¸</button>
            <button class="btn btn-feedback" onclick="showTab('feedback')" id="tab-feedback">ğŸ‘ í”¼ë“œë°± ë¡œê·¸</button>
            <button class="btn btn-warning" onclick="showTab('data')" id="tab-data">ğŸ“š ë°ì´í„° ê´€ë¦¬</button>
        </div>
    </div>
    
    <!-- ëŒ€í™” ë¡œê·¸ íƒ­ -->
    <div id="chat-tab" class="tab-content active">
        <div class="controls">
            <div style="margin-bottom: 15px;">
                <strong>ì¹´í…Œê³ ë¦¬ë³„ í•„í„°:</strong>
                <button class="btn btn-primary" onclick="loadLogsByCategory('all')" id="btn-all">ì „ì²´</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ì‹ ì²­ë°©ë²•')" id="btn-ì‹ ì²­ë°©ë²•">ì‹ ì²­ë°©ë²•</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('í’ˆëª©')" id="btn-í’ˆëª©">í’ˆëª©</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ë“±ê¸‰ì‹ ì²­ì¡°ê±´')" id="btn-ë“±ê¸‰ì‹ ì²­ì¡°ê±´">ë“±ê¸‰ì‹ ì²­ì¡°ê±´</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ë³¸ì¸ë¶€ë‹´ë¥ ')" id="btn-ë³¸ì¸ë¶€ë‹´ë¥ ">ë³¸ì¸ë¶€ë‹´ë¥ </button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ìê²©í™•ì¸')" id="btn-ìê²©í™•ì¸">ìê²©í™•ì¸</button>
                <button class="btn btn-blocked" onclick="loadLogsByCategory('ì°¨ë‹¨ëœì§ˆë¬¸')" id="btn-ì°¨ë‹¨ëœì§ˆë¬¸">ì°¨ë‹¨ëœì§ˆë¬¸</button>
                <button class="btn btn-primary" onclick="loadLogsByCategory('ê¸°íƒ€')" id="btn-ê¸°íƒ€">ê¸°íƒ€</button>
            </div>
            <div>
                <strong>ê°œìˆ˜ë³„ í•„í„°:</strong>
                <button class="btn btn-primary" onclick="loadLogs(20)">ìµœê·¼ 20ê°œ</button>
                <button class="btn btn-primary" onclick="loadLogs(50)">ìµœê·¼ 50ê°œ</button>
                <button class="btn btn-primary" onclick="loadLogs(100)">ìµœê·¼ 100ê°œ</button>
                <button class="btn btn-primary" onclick="loadLogs()">ì „ì²´</button>
                <span class="auto-refresh">ìë™ ìƒˆë¡œê³ ì¹¨: 30ì´ˆ</span>
            </div>
        </div>
        
        <div id="logs">
            <div class="loading">ë¡œë”© ì¤‘...</div>
        </div>
    </div>
    
    <!-- í”¼ë“œë°± ë¡œê·¸ íƒ­ -->
    <div id="feedback-tab" class="tab-content">
        <div class="feedback-section">
            <h3>ğŸ“Š í”¼ë“œë°± í•„í„°</h3>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="loadFeedbackLogs('all')" id="btn-feedback-all">ì „ì²´ í”¼ë“œë°±</button>
                <button class="btn btn-feedback" onclick="loadFeedbackLogs('like')" id="btn-feedback-like">ğŸ‘ ì¢‹ì•„ìš”ë§Œ</button>
                <button class="btn btn-feedback dislike" onclick="loadFeedbackLogs('dislike')" id="btn-feedback-dislike">ğŸ‘ ì‹«ì–´ìš”ë§Œ</button>
            </div>
        </div>
        
        <div id="feedback-logs">
            <div class="loading">í”¼ë“œë°± ë¡œë”© ì¤‘...</div>
        </div>
    </div>
    
    <!-- ë°ì´í„° ê´€ë¦¬ íƒ­ -->
    <div id="data-tab" class="tab-content">
        <div class="feedback-section">
            <h3>ğŸ“š ë²¡í„°ìŠ¤í† ì–´ ë°ì´í„° ê´€ë¦¬</h3>
            
            <!-- ìƒˆ ë°ì´í„° ì¶”ê°€ -->
            <div style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 5px;">
                <h4>ğŸ“ ìƒˆ ë°ì´í„° ì¶”ê°€</h4>
                <div class="form-group">
                    <label for="new-title">ì œëª©:</label>
                    <input type="text" id="new-title" placeholder="ìƒˆ ë¬¸ì„œì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label for="new-url">URL (ì„ íƒì‚¬í•­):</label>
                    <input type="text" id="new-url" placeholder="ê´€ë ¨ URLì´ ìˆë‹¤ë©´ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label for="new-content">ë‚´ìš©:</label>
                    <textarea id="new-content" placeholder="ìƒˆ ë¬¸ì„œì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <button class="btn btn-feedback" onclick="addNewData()">ğŸ“„ ë°ì´í„° ì¶”ê°€</button>
            </div>
            
            <!-- JSON íŒŒì¼ë¡œ ì¶”ê°€ -->
            <div style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 5px;">
                <h4>ğŸ“ JSON íŒŒì¼ë¡œ ë°ì´í„° ì¶”ê°€</h4>
                <div class="form-group">
                    <label for="json-filename">JSON íŒŒì¼ëª…:</label>
                    <input type="text" id="json-filename" placeholder="ì˜ˆ: new_data.json" value="">
                </div>
                <button class="btn btn-feedback" onclick="addFromJsonFile()">ğŸ“ JSON íŒŒì¼ ì¶”ê°€</button>
            </div>
            
            <!-- ë²¡í„°ìŠ¤í† ì–´ ì¬êµ¬ì¶• -->
            <div style="background: #fff3cd; padding: 20px; border-radius: 5px;">
                <h4>ğŸ”„ ë²¡í„°ìŠ¤í† ì–´ ì¬êµ¬ì¶•</h4>
                <p>âš ï¸ ì£¼ì˜: ì´ ì‘ì—…ì€ ê¸°ì¡´ ë²¡í„°ìŠ¤í† ì–´ë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ê³  ê¸°ë³¸ JSON ë°ì´í„°ë¡œë§Œ ì¬êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
                <button class="btn btn-blocked" onclick="rebuildVectorstore()">ğŸ”„ ë²¡í„°ìŠ¤í† ì–´ ì¬êµ¬ì¶•</button>
            </div>
        </div>
        
        <div id="data-result" style="margin-top: 20px;"></div>
    </div>

    <script>
        let autoRefreshInterval;
        let currentTab = 'chat';
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ko-KR');
        }
        
        function getStatusText(status) {
            return status === 'success' ? 'ì„±ê³µ' : 'ì°¨ë‹¨/ì˜¤ë¥˜';
        }
        
        function getStatusClass(status) {
            return status === 'success' ? 'status-success' : 'status-fallback';
        }
        
        function showTab(tabName) {
            currentTab = tabName;
            
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ ë³´ì´ê¸°
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('btn-feedback', 'btn-warning');
                btn.classList.add('btn-primary');
            });
            
            if (tabName === 'feedback') {
                document.getElementById('tab-feedback').classList.remove('btn-primary');
                document.getElementById('tab-feedback').classList.add('btn-feedback');
                loadFeedbackLogs('all');
            } else if (tabName === 'data') {
                document.getElementById('tab-data').classList.remove('btn-primary');
                document.getElementById('tab-data').classList.add('btn-warning');
            } else {
                document.getElementById('tab-chat').classList.remove('btn-primary');
                document.getElementById('tab-chat').classList.add('btn-feedback');
                loadLogs();
            }
        }
        
        async function loadStats() {
            try {
                const [chatResponse, feedbackResponse] = await Promise.all([
                    fetch('/admin/api/logs'),
                    fetch('/admin/api/feedback')
                ]);
                
                const chatData = await chatResponse.json();
                const feedbackData = await feedbackResponse.json();
                
                const totalQuestions = chatData.logs.length;
                const successCount = chatData.logs.filter(log => log.status === 'success').length;
                const fallbackCount = totalQuestions - successCount;
                const successRate = totalQuestions > 0 ? Math.round((successCount / totalQuestions) * 100) : 0;
                
                const likeCount = feedbackData.feedback_logs.filter(f => f.feedback_type === 'like').length;
                const dislikeCount = feedbackData.feedback_logs.filter(f => f.feedback_type === 'dislike').length;
                const totalFeedback = likeCount + dislikeCount;
                
                // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ê³„ì‚° (ë²„íŠ¼ ì—…ë°ì´íŠ¸ìš©)
                const categoryStats = {};
                chatData.logs.forEach(log => {
                    const category = log.category || 'ê¸°íƒ€';
                    if (!categoryStats[category]) {
                        categoryStats[category] = 0;
                    }
                    categoryStats[category]++;
                });
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalQuestions}</div>
                        <div class="stat-label">ì „ì²´ ì§ˆë¬¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${successCount}</div>
                        <div class="stat-label">ì„±ê³µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${totalFeedback}</div>
                        <div class="stat-label">ì´ í”¼ë“œë°±</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${likeCount}</div>
                        <div class="stat-label">ğŸ‘ ì¢‹ì•„ìš”</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${dislikeCount}</div>
                        <div class="stat-label">ğŸ‘ ì‹«ì–´ìš”</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${successRate}%</div>
                        <div class="stat-label">ì„±ê³µë¥ </div>
                    </div>
                `;
                
                // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ì— ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateCategoryButtonCounts(categoryStats);
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        function updateCategoryButtonCounts(categoryStats) {
            // ì „ì²´ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const totalCount = Object.values(categoryStats).reduce((sum, count) => sum + count, 0);
            const allButton = document.getElementById('btn-all');
            if (allButton) {
                allButton.textContent = `ì „ì²´ (${totalCount})`;
            }
            
            // ê° ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const categories = ['ì‹ ì²­ë°©ë²•', 'í’ˆëª©', 'ë“±ê¸‰ì‹ ì²­ì¡°ê±´', 'ë³¸ì¸ë¶€ë‹´ë¥ ', 'ìê²©í™•ì¸', 'ì°¨ë‹¨ëœì§ˆë¬¸', 'ê¸°íƒ€'];
            categories.forEach(category => {
                const button = document.getElementById(`btn-${category}`);
                if (button) {
                    const count = categoryStats[category] || 0;
                    button.textContent = `${category} (${count})`;
                }
            });
        }
        
        async function loadLogs(limit = null) {
            try {
                const url = limit ? `/admin/api/logs?limit=${limit}` : '/admin/api/logs';
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.logs && data.logs.length > 0) {
                    const logsHtml = data.logs.map(log => `
                        <div class="log-item">
                            <div class="log-header">
                                <span class="log-time">${formatTime(log.timestamp)}</span>
                                <span class="log-status ${getStatusClass(log.status)}">${getStatusText(log.status)}</span>
                                <span class="log-category" style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">${log.category || 'ê¸°íƒ€'}</span>
                            </div>
                            <div class="log-content">
                                <div class="log-question">
                                    <strong>ì§ˆë¬¸:</strong> ${log.question}
                                </div>
                                <div class="log-answer">
                                    <strong>ë‹µë³€:</strong> ${log.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('logs').innerHTML = logsHtml;
                } else {
                    document.getElementById('logs').innerHTML = '<div class="no-logs">ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('logs').innerHTML = '<div class="loading">ë¡œë“œ ì‹¤íŒ¨</div>';
            }
        }
        
        async function loadLogsByCategory(category) {
            try {
                console.log(`ì¹´í…Œê³ ë¦¬ '${category}' ë¡œë”© ì¤‘...`);
                const url = `/admin/api/logs?category=${category}`;
                const response = await fetch(url);
                const data = await response.json();
                
                console.log(`ì¹´í…Œê³ ë¦¬ '${category}' ê²°ê³¼:`, data.logs.length, 'ê°œ ë¡œê·¸');
                
                if (data.logs && data.logs.length > 0) {
                    const logsHtml = data.logs.map(log => `
                        <div class="log-item">
                            <div class="log-header">
                                <span class="log-time">${formatTime(log.timestamp)}</span>
                                <span class="log-status ${getStatusClass(log.status)}">${getStatusText(log.status)}</span>
                                <span class="log-category" style="background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-size: 12px;">${log.category || 'ê¸°íƒ€'}</span>
                            </div>
                            <div class="log-content">
                                <div class="log-question">
                                    <strong>ì§ˆë¬¸:</strong> ${log.question}
                                </div>
                                <div class="log-answer">
                                    <strong>ë‹µë³€:</strong> ${log.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('logs').innerHTML = logsHtml;
                } else {
                    document.getElementById('logs').innerHTML = `<div class="no-logs">'${category}' ì¹´í…Œê³ ë¦¬ì˜ ëŒ€í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. (ì´ ${data.logs ? data.logs.length : 0}ê°œ)</div>`;
                }
                
                // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
                highlightSelectedCategory(category);
            } catch (error) {
                console.error('ì¹´í…Œê³ ë¦¬ë³„ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('logs').innerHTML = '<div class="loading">ë¡œë“œ ì‹¤íŒ¨</div>';
            }
        }
        
        async function loadFeedbackLogs(type = 'all') {
            try {
                const url = type === 'all' ? '/admin/api/feedback' : `/admin/api/feedback?type=${type}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.feedback_logs && data.feedback_logs.length > 0) {
                    const feedbackHtml = data.feedback_logs.map(feedback => `
                        <div class="feedback-item">
                            <div class="feedback-content">
                                <div style="margin-bottom: 10px;">
                                    <strong>ì‹œê°„:</strong> ${formatTime(feedback.timestamp)}
                                    <span class="feedback-type ${feedback.feedback_type === 'like' ? 'feedback-like' : 'feedback-dislike'}">
                                        ${feedback.feedback_type === 'like' ? 'ğŸ‘ ì¢‹ì•„ìš”' : 'ğŸ‘ ì‹«ì–´ìš”'}
                                    </span>
                                </div>
                                <div style="margin-bottom: 5px;">
                                    <strong>ì§ˆë¬¸:</strong> ${feedback.question}
                                </div>
                                <div>
                                    <strong>ë‹µë³€:</strong> ${feedback.answer.length > 100 ? feedback.answer.substring(0, 100) + '...' : feedback.answer}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('feedback-logs').innerHTML = feedbackHtml;
                } else {
                    document.getElementById('feedback-logs').innerHTML = '<div class="no-logs">ì•„ì§ í”¼ë“œë°±ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                
                // ì„ íƒëœ í”¼ë“œë°± ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
                highlightSelectedFeedback(type);
            } catch (error) {
                console.error('í”¼ë“œë°± ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('feedback-logs').innerHTML = '<div class="loading">ë¡œë“œ ì‹¤íŒ¨</div>';
            }
        }
        
        function highlightSelectedCategory(selectedCategory) {
            // ëª¨ë“  ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            const categories = ['all', 'ì‹ ì²­ë°©ë²•', 'í’ˆëª©', 'ë“±ê¸‰ì‹ ì²­ì¡°ê±´', 'ë³¸ì¸ë¶€ë‹´ë¥ ', 'ìê²©í™•ì¸', 'ì°¨ë‹¨ëœì§ˆë¬¸', 'ê¸°íƒ€'];
            categories.forEach(category => {
                const button = document.getElementById(`btn-${category}`);
                if (button) {
                    if (category === 'ì°¨ë‹¨ëœì§ˆë¬¸') {
                        button.style.background = 'radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%)';
                    } else {
                        button.style.background = 'radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%)';
                    }
                    button.style.transform = 'none';
                }
            });
            
            // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            const selectedButton = document.getElementById(`btn-${selectedCategory}`);
            if (selectedButton) {
                if (selectedCategory === 'ì°¨ë‹¨ëœì§ˆë¬¸') {
                    selectedButton.style.background = 'radial-gradient(circle at center, #e74c3c 0%, #dc3545 40%, #c82333 70%, #bd2130 100%)';
                } else {
                    selectedButton.style.background = 'radial-gradient(circle at center, #667eea 0%, #5a67d8 40%, #4c51bf 70%, #434190 100%)';
                }
                selectedButton.style.transform = 'translateY(-2px)';
            }
        }
        
        function highlightSelectedFeedback(selectedType) {
            // ëª¨ë“  í”¼ë“œë°± ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            const types = ['all', 'like', 'dislike'];
            types.forEach(type => {
                const button = document.getElementById(`btn-feedback-${type}`);
                if (button) {
                    button.style.transform = 'none';
                    if (type === 'dislike') {
                        button.style.background = 'radial-gradient(circle at center, #dc3545 0%, #c82333 40%, #bd2130 70%, #a71e2a 100%)';
                    } else if (type === 'like') {
                        button.style.background = 'radial-gradient(circle at center, #28a745 0%, #218838 40%, #1e7e34 70%, #155724 100%)';
                    } else {
                        button.style.background = 'radial-gradient(circle at center, #b0b0b0 0%, #a0a0a0 40%, #909090 70%, #808080 100%)';
                    }
                }
            });
            
            // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            const selectedButton = document.getElementById(`btn-feedback-${selectedType}`);
            if (selectedButton) {
                selectedButton.style.transform = 'translateY(-2px)';
            }
        }
        
        function refreshData() {
            loadStats();
            if (currentTab === 'chat') {
                loadLogs();
            } else if (currentTab === 'feedback') {
                loadFeedbackLogs('all');
            }
            // data íƒ­ì€ ìƒˆë¡œê³ ì¹¨ ì—†ìŒ
        }
        
        // ìƒˆ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
        async function addNewData() {
            const title = document.getElementById('new-title').value.trim();
            const content = document.getElementById('new-content').value.trim();
            const url = document.getElementById('new-url').value.trim();
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await fetch('/admin/add_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        url: url
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âœ… ${data.message}
                        </div>`;
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('new-title').value = '';
                    document.getElementById('new-content').value = '';
                    document.getElementById('new-url').value = '';
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âŒ ì˜¤ë¥˜: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>`;
            }
        }
        
        // JSON íŒŒì¼ë¡œ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
        async function addFromJsonFile() {
            const filename = document.getElementById('json-filename').value.trim();
            
            if (!filename) {
                alert('JSON íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await fetch('/admin/add_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        json_file: filename
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âœ… ${data.message}
                        </div>`;
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('json-filename').value = '';
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âŒ ì˜¤ë¥˜: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>`;
            }
        }
        
        // ë²¡í„°ìŠ¤í† ì–´ ì¬êµ¬ì¶• í•¨ìˆ˜
        async function rebuildVectorstore() {
            if (!confirm('ì •ë§ë¡œ ë²¡í„°ìŠ¤í† ì–´ë¥¼ ì¬êµ¬ì¶•í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì¶”ê°€ë¡œ ë„£ì€ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        ğŸ”„ ë²¡í„°ìŠ¤í† ì–´ ì¬êµ¬ì¶• ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.
                    </div>`;
                
                const response = await fetch('/admin/rebuild_vectorstore', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âœ… ${data.message}
                        </div>`;
                } else {
                    document.getElementById('data-result').innerHTML = 
                        `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            âŒ ì˜¤ë¥˜: ${data.error}
                        </div>`;
                }
            } catch (error) {
                document.getElementById('data-result').innerHTML = 
                    `<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-top: 10px;">
                        âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>`;
            }
        }
        
        function startAutoRefresh() {
            // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            autoRefreshInterval = setInterval(() => {
                refreshData();
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ ë° ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘
        window.onload = function() {
            refreshData();
            startAutoRefresh();
        };
        
        // í˜ì´ì§€ ë– ë‚  ë•Œ ìë™ ìƒˆë¡œê³ ì¹¨ ì¤‘ì§€
        window.onbeforeunload = function() {
            stopAutoRefresh();
        };
    </script>
</body>
</html>